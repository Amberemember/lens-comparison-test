<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Image Comparison</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #111827;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 24px;
    }

    .compare-root {
      width: 100%;
      max-width: 1100px;
      border-radius: 12px;
      background: #020617;
      border: 1px solid #1f2937;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      padding: 16px 16px 20px;
    }

    .compare-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      gap: 12px;
    }

    .compare-title {
      font-size: 16px;
      font-weight: 600;
      color: #f9fafb;
    }

    .compare-groups {
      display: flex;
      justify-content: flex-end;
    }

    .compare-groups select {
      border-radius: 999px;
      border: 1px solid #374151;
      background: #020617;
      padding: 4px 10px;
      font-size: 13px;
      color: #e5e7eb;
      cursor: pointer;
      outline: none;
    }

    .compare-main {
      display: flex;
      gap: 8px;
      height: 420px;
      margin-top: 4px;
    }

    .compare-pane {
      flex: 1;
      position: relative;
      border-radius: 10px;
      overflow: hidden;
      background: #020617;
      border: 1px solid #1f2937;
      cursor: grab;
      user-select: none;
    }

    .compare-pane:active {
      cursor: grabbing;
    }

    .compare-pane-label {
      position: absolute;
      top: 8px;
      left: 8px;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(55, 65, 81, 0.9);
      font-size: 11px;
      color: #e5e7eb;
      z-index: 2;
      pointer-events: none;
    }

    .compare-pane img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      transform-origin: center center;
      transform: translate(0px, 0px) scale(1);
      will-change: transform;
      pointer-events: none;
    }

    .compare-footer {
      margin-top: 8px;
      font-size: 12px;
      color: #6b7280;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .compare-footer span {
      white-space: nowrap;
    }

    @media (max-width: 768px) {
      .compare-main {
        flex-direction: column;
        height: 360px;
      }
    }
  </style>
</head>
<body>
  <div class="compare-root" id="compare-root">
    <div class="compare-header">
      <div class="compare-title">图像对比（同步缩放与拖动）</div>
      <div class="compare-groups">
        <select id="compare-select"></select>
      </div>
    </div>

    <div class="compare-main">
      <div class="compare-pane" data-side="left">
        <div class="compare-pane-label">Left</div>
        <img src="" alt="left image" />
      </div>
      <div class="compare-pane" data-side="right">
        <div class="compare-pane-label">Right</div>
        <img src="" alt="right image" />
      </div>
    </div>

    <div class="compare-footer">
      <span>滚轮：缩放 | 按住拖动：平移</span>
      <span id="view-status"></span>
    </div>
  </div>

  <script>
    // 配置图片组
    const imageGroups = [
      {
        label: "最大光圈",
        left:  "./参考图片/实拍对比/近摄对比/35GM_近摄/f1.4.jpg",
        right: "./参考图片/实拍对比/近摄对比/TS35_近摄/f1.6.jpg"
      },
      {
        label: "f/2.0",
        left:  "./参考图片/实拍对比/近摄对比/35GM_近摄/f2.jpg",
        right: "./参考图片/实拍对比/近摄对比/TS35_近摄/f2.jpg"
      },
      {
        label: "f/2.8",
        left:  "./参考图片/实拍对比/近摄对比/35GM_近摄/f2.8.jpg",
        right: "./参考图片/实拍对比/近摄对比/TS35_近摄/f2.8.jpg"
      },
      {
        label: "f/4.0",
        left:  "./参考图片/实拍对比/近摄对比/35GM_近摄/f4.jpg",
        right: "./参考图片/实拍对比/近摄对比/TS35_近摄/f4.jpg"
      },
      {
        label: "f/5.6",
        left:  "./参考图片/实拍对比/近摄对比/35GM_近摄/f5.6.jpg",
        right: "./参考图片/实拍对比/近摄对比/TS35_近摄/f5.6.jpg"
      },
      {
        label: "f/8.0",
        left:  "./参考图片/实拍对比/近摄对比/35GM_近摄/f8.jpg",
        right: "./参考图片/实拍对比/近摄对比/TS35_近摄/f8.jpg"
      },
      {
        label: "f/16",
        left:  "./参考图片/实拍对比/近摄对比/35GM_近摄/f16.jpg",
        right: "./参考图片/实拍对比/近摄对比/TS35_近摄/f16.jpg"
      }
    ];

    class SynchronizedImageCompare {
      constructor(root, groups) {
        this.root = root;
        this.groups = groups;
        this.currentGroupIndex = 0;

        this.panes = Array.from(root.querySelectorAll(".compare-pane"));
        this.images = this.panes.map(p => p.querySelector("img"));
        this.groupSelect = root.querySelector("#compare-select");
        this.statusEl = root.querySelector("#view-status");

        this.state = {
          scale: 1,
          offsetX: 0,
          offsetY: 0
        };

        this.dragging = {
          active: false,
          startX: 0,
          startY: 0,
          originX: 0,
          originY: 0
        };

        this.MIN_SCALE = 1;
        this.MAX_SCALE = 8;

        this.buildGroupSelect();
        this.setGroup(0);
        this.attachInteractions();
        this.updateStatus();
      }

      buildGroupSelect() {
        this.groupSelect.innerHTML = "";
        this.groups.forEach((g, idx) => {
          const opt = document.createElement("option");
          opt.value = idx;
          opt.textContent = g.label;
          this.groupSelect.appendChild(opt);
        });

        this.groupSelect.addEventListener("change", (e) => {
          const idx = Number(e.target.value);
          this.setGroup(idx);
        });
      }

      setGroup(index) {
        this.currentGroupIndex = index;
        const group = this.groups[index];
        this.images[0].src = group.left;
        this.images[1].src = group.right;

        // 同步下拉选中项
        this.groupSelect.value = String(index);

        // 重置视图
        this.state.scale = 1;
        this.state.offsetX = 0;
        this.state.offsetY = 0;
        this.applyTransform();
        this.updateStatus();
      }

      attachInteractions() {
        this.panes.forEach(pane => {
          pane.addEventListener(
            "wheel",
            (e) => this.onWheel(e, pane),
            { passive: false }
          );

          pane.addEventListener("mousedown", (e) => this.onDragStart(e));
          window.addEventListener("mousemove", (e) => this.onDragMove(e));
          window.addEventListener("mouseup",   () => this.onDragEnd());
          pane.addEventListener("mouseleave",  () => this.onDragEnd());
        });
      }

      onWheel(e, pane) {
        e.preventDefault();

        const delta = e.deltaY;
        const zoomFactor = delta < 0 ? 1.1 : 0.9;
        let newScale = this.state.scale * zoomFactor;
        newScale = Math.max(this.MIN_SCALE, Math.min(this.MAX_SCALE, newScale));

        this.state.scale = newScale;
        this.applyTransform();
        this.updateStatus();
      }

      onDragStart(e) {
        e.preventDefault();
        this.dragging.active = true;
        this.dragging.startX = e.clientX;
        this.dragging.startY = e.clientY;
        this.dragging.originX = this.state.offsetX;
        this.dragging.originY = this.state.offsetY;
      }

      onDragMove(e) {
        if (!this.dragging.active) return;
        const dx = e.clientX - this.dragging.startX;
        const dy = e.clientY - this.dragging.startY;

        this.state.offsetX = this.dragging.originX + dx;
        this.state.offsetY = this.dragging.originY + dy;

        this.applyTransform();
        this.updateStatus();
      }

      onDragEnd() {
        this.dragging.active = false;
      }

      applyTransform() {
        const { scale, offsetX, offsetY } = this.state;
        const transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
        this.images.forEach(img => {
          img.style.transform = transform;
        });
      }

      updateStatus() {
        this.statusEl.textContent =
          `缩放: ${this.state.scale.toFixed(2)}x | 平移: (${this.state.offsetX.toFixed(0)}, ${this.state.offsetY.toFixed(0)})`;
      }
    }

    const root = document.getElementById("compare-root");
    new SynchronizedImageCompare(root, imageGroups);
  </script>
</body>
</html>
